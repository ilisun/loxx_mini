# ИТЕРАЦИЯ 1. Спецификация минималистичного приложения OSM (iOS)

## 1. Цель
Создать простое, минималистичное iOS-приложение, которое показывает карту OpenStreetMap, текущее местоположение пользователя по GPS и предоставляет минимальный набор элементов управления (центрирование, масштабирование).

## 2. Основной функционал MVP
- **Карта на весь экран** с данными OpenStreetMap.
- **Используемый движок**: MapLibre GL Native.
- **Источник данных**: растровые тайлы OSM (`https://tile.openstreetmap.org/{z}/{x}/{y}.png`).
- **Отображение текущего местоположения**:
  - При первом запуске карта открывается на фиксированном центре (например, весь мир).
  - Разрешение геолокации запрашивается **только по нажатию кнопки «Найти меня»**.
  - После разрешения на карте **постоянно виден маркер текущего положения** (синяя точка), обновляемый при движении.
- **Кнопки управления**:
  - Внизу фиксированный **тулбар** с тремя кнопками:
    - «–» — уменьшить масштаб.
    - «Найти меня» — центрировать карту на текущем местоположении.
    - «+» — увеличить масштаб.
- **Масштаб карты** управляется только кнопками «+»/«–» (без авто-зумирования при центрировании).
- **Темы**: один (светлый) вариант интерфейса, без переключения светлая/тёмная.

## 3. Архитектура приложения
- **Клиент**: нативное iOS-приложение (Swift + SwiftUI).
- **Карта**: MapLibre GL Native для отображения растровых тайлов.
- **Геолокация**: `CoreLocation` для получения GPS-координат.
- **UI**: `SwiftUI` или `UIKit` (по выбору разработчика) с картой на весь экран и тулбаром снизу.

## 4. Обработка данных
- **Тайлы OSM** загружаются напрямую из открытого сервера OpenStreetMap (или другого провайдера).
- **Данные местоположения**:
  - Получаются через `CoreLocation` только после согласия пользователя.
  - Используются только локально для отображения маркера; никуда не отправляются.

## 5. Стратегия обработки ошибок
- **Нет доступа к геолокации**: при нажатии «Найти меня» показывать системный алерт с запросом разрешения; если отказано — уведомить пользователя.
- **Нет интернета**: отображается кэш карты MapLibre (если он есть); при отсутствии тайлов — пустой фон или сообщение «нет данных».
- **Сбой загрузки тайлов**: повторная попытка загрузки, стандартный fallback MapLibre.

## 6. План тестирования
### Функциональные тесты
- Запуск приложения, отображение карты.
- Нажатие «Найти меня» — запрос разрешения на геолокацию, центрирование карты.
- Отображение маркера текущего местоположения.
- Увеличение/уменьшение масштаба кнопками «+»/«–».
- Работа тулбара снизу.

### Тесты ошибок
- Отказ пользователя в доступе к геолокации.
- Отсутствие интернет-соединения (проверка поведения тайлов).
- Перемещение пользователя — обновление маркера.

### UI-тесты
- Корректное отображение тулбара и карты на разных моделях iPhone.
- Проверка минималистичного интерфейса (ничего лишнего).

## 7. Платформа
- iPhone (без адаптации под iPad).

# ИТЕРАЦИЯ 2. Спецификация по поддержке векторных карт OpenFreeMap

## 1. Цель
Добавить поддержку векторных карт OpenFreeMap (стиль Liberty) в минималистичное приложение, сохранив существующий интерфейс и функциональность, и дать пользователю возможность переключаться между растровой и векторной картой.

## 2. Основной функционал
- Сохраняется текущий UI:
  - Карта на весь экран.
  - Тулбар снизу с кнопками «–», «Найти меня», «+».
- Добавляется **новая кнопка-переключатель** в тулбаре:
  - Переключает источник карты между:
    - **Растровые OSM-тайлы** (`https://tile.openstreetmap.org/{z}/{x}/{y}.png`).
    - **Векторные OpenFreeMap Liberty** (Style JSON + MVT).
  - Состояние режима явно не подписывается — пользователь видит по виду карты.
- При запуске приложения всегда активен **растровый режим**.
- Маркер текущего положения (синяя точка) работает одинаково в обоих режимах.
- Масштаб управляется только кнопками «+»/«–» (без автозума при «Найти меня»).
- Темы — только светлая, без переключения.

## 3. Интеграция OpenFreeMap
- Используется **только стиль Liberty**.
- **Style JSON загружается онлайн при запуске**:
  - URL стиля указывается напрямую.
  - Тайлы векторные подкачиваются онлайн с серверов OpenFreeMap.
- Кэширование:
  - Используется **встроенное кэширование MapLibre GL Native**.
  - Собственного менеджера кэша пока нет.
- Атрибуция:
  - На экране/в настройках приложения добавить строку «© OpenFreeMap / OpenMapTiles / OSM contributors».

## 4. Архитектура изменений
- **UI**:
  - Добавить четвёртую кнопку-переключатель в нижний тулбар.
  - При нажатии кнопки:
    - Если режим «растровый» — инициализировать MapLibre на Liberty Style JSON.
    - Если режим «векторный» — переключить на растровые тайлы.
- **Карта**:
  - MapLibre GL Native инициализируется с выбранным стилем.
  - При переключении:
    - Сохраняется положение карты и зум.
    - Сохраняется и обновляется маркер текущего положения.
- **Геолокация**:
  - Использует CoreLocation, как в первой итерации.
  - Разрешение запрашивается только по нажатию «Найти меня».

## 5. Обработка ошибок
- Если Style JSON недоступен при загрузке:
  - Показать сообщение «Невозможно загрузить векторный стиль» и оставить растровую карту.
- Если тайлы недоступны (нет интернета):
  - MapLibre показывает кэшированные данные или пустой фон.
- Если пользователь не дал доступ к геолокации:
  - «Найти меня» вызывает системный алерт.

## 6. План тестирования
### Функциональные тесты
- Переключение между растровой и векторной картой.
- Сохранение положения карты при переключении.
- Отображение маркера текущего положения в обоих режимах.
- Работоспособность кнопок «+», «–», «Найти меня» в обоих режимах.

### Тесты ошибок
- Нет интернета при переключении — проверка кэша.
- Недоступность Style JSON — проверка fallback.

### UI-тесты
- Проверка тулбара с четырьмя кнопками на разных моделях iPhone.
- Корректная загрузка Liberty Style JSON.

## 7. Платформа
- iPhone (без адаптации под iPad).

